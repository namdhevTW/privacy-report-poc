<div class="grid grid-cols-6 gap-8 items-center p-4 bg-gray-50 mt-3">
  <!-- <div class="col-span-1 mr-auto">
    <nz-segmented [nzOptions]="['Pending', 'Completed']" [(ngModel)]="selectedTab" (ngModelChange)="changeSelectedTab($event)" nzSize="large"></nz-segmented>
  </div> -->

  <!--#region: filters-->
  <div class="col-span-6 ml-auto">
    <!-- Consent mode -->
    <span class="flex items-center">

    <!--State options-->
    <!-- <span class="text-lg pr-2 pl-4">State: </span>
    <nz-select [nzOptionOverflowSize]="states.length" [nzDropdownMatchSelectWidth]="false" [(ngModel)]="selectedState" (ngModelChange)="applyFilter()" nzSize="large">
      @for (state of states; track state) {
      <nz-option [nzValue]="state" [nzLabel]="state"></nz-option>
      }
    </nz-select> -->

    <!-- Service Dropdown -->
    @if(role === 'coordinator') {
    <span class="text-lg pl-4 pr-2">New version (WIP)</span>
    <nz-switch [(ngModel)]="isNewVersion" (ngModelChange)="onNewVersionClick()"></nz-switch>

    <span class="text-lg pl-4 pr-2">Service: </span>
    <nz-select [nzOptionOverflowSize]="services.length" [nzDropdownMatchSelectWidth]="false" [(ngModel)]="selectedService" (ngModelChange)="changeSelectedService($event); applyFilter()" nzSize="large">
      @for (service of services; track service) {
      <nz-option [nzValue]="service.value" [nzLabel]="service.label"></nz-option>
      }
    </nz-select>
    }


    <!-- Request creation range picker -->
    <span class="text-lg pl-4 pr-2">Date range: </span>
    <nz-range-picker #dateRangePicker [nzRanges]="presetQuickDateRanges" [ngModel]="[selectedStartDate, selectedEndDate]"
      (ngModelChange)="changeSelectedDateRange($event); storeDateRangeControl(dateRangePicker)" [nzFormat]="'dd-MMM-yyyy'" nzSize="large" [nzDisabledDate]="disabledDates"></nz-range-picker>
    <span class="pr-2"></span>

    <a nz-tooltip nzTooltipTitle="Remove all filters" (click)="removeFilter()">
      <span nz-icon nzType="close" nzTheme="outline"></span>
    </a>
  </span>
  </div>
  <!--#endregion-->

</div>
<!--
@switch (selectedTab) {
  @case(0) { -->
    @if(isNewVersion) {
      @if(role === 'coordinator') {
      <div class="bg-slate-100 p-4">
        <nz-row [nzGutter]="[10, 10]" class="border-2">
          <nz-col class="gutter-row m-auto">
            <span class="pl-4 text-xl font-semibold">
              Total pending requests
            </span>
            <ngx-charts-number-card
             [view]="[300, 200]"
             cardColor="#fff"
             [results]="[{name: 'requests need action', value: requestStats.pending}]"
             bandColor="#dc2626"
             >Total pending requests</ngx-charts-number-card>
          </nz-col>
          <nz-col class="gutter-row m-auto">
            <span class="pl-4 text-xl font-semibold">
              Most contributing service
            </span>
            <ngx-charts-number-card
            [view]="[300, 200]"
             cardColor="#fff"
             [results]="[{name: requestStats.topServiceContributingToPending, value: requestStats.topServicePendingCount}]"
             bandColor="#1e40af"
             ></ngx-charts-number-card>
          </nz-col>
          <nz-col class="gutter-row m-auto">
            <span class="pl-4 text-xl font-semibold">
              Most contributing stage
            </span>
            <ngx-charts-number-card
            [view]="[300, 200]"
             cardColor="#fff"
             [results]="[{name: requestStats.topCurrentStageContributingToPending, value: requestStats.topCurrentStagePendingCount}]"
             bandColor="#a16207"
             ></ngx-charts-number-card>
          </nz-col>
          <nz-col class="gutter-row m-auto">
            <span class="pl-4 text-xl font-semibold">
              Total Exceeded SLA
            </span>
            <ngx-charts-number-card
            [view]="[300, 200]"
             cardColor="#fff"
             [results]="[{name: '# of pending requests', value: requestStats.exceededSLA}]"
             bandColor="#be185d"
             ></ngx-charts-number-card>
          </nz-col>
          <nz-col class="gutter-row m-auto">
            <span class="pl-4 text-xl font-semibold">
              Total Met SLA
            </span>
            <ngx-charts-number-card
            [view]="[300, 200]"
            cardColor="#fff"
            [results]="[{name: '# of pending requests', value: requestStats.meetsSLA}]"
            bandColor="#059669"
            ></ngx-charts-number-card>
          </nz-col>
        </nz-row>
        <nz-row [nzGutter]="[10, 10]" class="py-10">
          <nz-col class="gutter-row border-2">
            <span class="pl-4 text-xl font-semibold">
              Top 5 service owner contribution with SLA Status
            </span>
            @if (top5ServiceOwnersWithSLAStatusChartOption.results.length > 0) {
              <ngx-charts-bar-horizontal-stacked
                [view]="[700, 400]"
                [scheme]="top5ServiceOwnersWithSLAStatusChartOption.colorScheme!"
                [results]="top5ServiceOwnersWithSLAStatusChartOption.results"
                roundBarEdges="true"
                [xAxis]="true"
                [yAxis]="true"
                [legend]="true"
                [showXAxisLabel]="true"
                [showYAxisLabel]="true"
                [xAxisLabel]="top5ServiceOwnersWithSLAStatusChartOption.xAxisLabel!"
                [yAxisLabel]="top5ServiceOwnersWithSLAStatusChartOption.yAxisLabel!"
                [showGridLines]="true"
                [showDataLabel]="true"
                (select)="onChartClickEvent($event, tableModal)"
              >
              </ngx-charts-bar-horizontal-stacked>
            } @else {
              <nz-empty nzNotFoundContent="There are no pending requests for the applied filter"></nz-empty>
            }
          </nz-col>
          <nz-col class="gutter-row ml-auto border-2">
            <span class="pl-4 text-xl font-semibold">
              Top 10 current stage contribution with SLA Status
            </span>
            @if (top10CurrentStagesWithSLAStatusChartOption.results.length > 0) {
              <ngx-charts-bar-vertical-stacked
                [view]="[900, 400]"
                [scheme]="top10CurrentStagesWithSLAStatusChartOption.colorScheme!"
                [results]="top10CurrentStagesWithSLAStatusChartOption.results"
                [xAxis]="true"
                [yAxis]="true"
                [legend]="true"
                [showXAxisLabel]="true"
                [showYAxisLabel]="true"
                xAxis
                [xAxisLabel]="top10CurrentStagesWithSLAStatusChartOption.xAxisLabel!"
                [yAxisLabel]="top10CurrentStagesWithSLAStatusChartOption.yAxisLabel!"
                [showGridLines]="true"
                [showDataLabel]="true"
                (select)="onChartClickEvent($event, tableModal)"
              >
              </ngx-charts-bar-vertical-stacked>
            } @else {
              <nz-empty nzNotFoundContent="There are no pending requests for the applied filter"></nz-empty>
            }
          </nz-col>
        </nz-row>
        <nz-row [nzGutter]="[10,10]" class="border-2">
          <span class="pl-4 text-xl font-semibold">
            Heatmap between current stage and service-owners
          </span>
          <nz-col class="gutter-row">
            <ngx-charts-heat-map
              [view]="[1600, 500]"
              [xAxis]="true"
              [yAxis]="true"
              [animations]="true"
              [legend]="true"
              [scheme]="heatmapColorScheme"
              [max]="10"
              [results]="currentStageServiceOwnerHeatMapChartOption"
            >
            </ngx-charts-heat-map>
          </nz-col>
        </nz-row>
      </div>
      } @else {

      }
    } @else {
      <div class="dashboard-content-wrapper bg-gray-50">
        @if(privacyData && privacyData.length > 0) {
        <div class="grid grid-cols-6 gap-2 mb-2">
          <div class="col-span-6 p-4">
            <div class="grid grid-cols-6 gap-1 rounded border-t-2 border-l-2 border-b-2 border-gray-500">
              @if(role === 'coordinator' && selectedService === 'all') {
              <div class="col-span-1 pt-2 pb-4 bg-blue-600 h-[17rem] relative">
                <span nz-icon nzType="info-circle" nzTheme="fill" class="absolute right-3 top-2 cursor-help text-2xl" nz-tooltip="Displays total pending requests that needs actioning. Clicking on the number would display the datatable in a modal."></span>
                  <div class="mb-4 flex flex-col items-center h-full text-white">
                    <div class="text-xl flex-none font-bold">Pending requests</div>
                    <div class="text-[1rem] font-semibold text-center pt-1 leading-4">Needs action from service owners</div>
                    <div class="text-8xl font-bold mt-auto cursor-pointer" (click)="onStatsClickEvent('Pending', tableModal)" (keypress)="onStatsClickEvent('Pending', tableModal)">{{requestStats.pending}}</div>
                  </div>
              </div>
              <div class="col-span-3 py-2 relative">
                @if(requestStats.pending > 0) {
                  <span nz-icon nzType="info-circle" nzTheme="fill" class="absolute right-3 top-2 cursor-help text-2xl z-20" nz-tooltip="Top 5 services that hold pending requests, by how many count? Click on the corresponding service bars to view the data."></span>
                  <div echarts [options]="pendingRequestsByServiceOwnerChartOption" class="h-full z-10" (chartClick)="onChartClickEvent($event, tableModal)"></div>
                } @else {
                  <div class="dnf-wrapper h-full flex flex-col w-full justify-center align-middle">
                    <nz-empty nzNotFoundContent="There are no pending requests for the applied filter"></nz-empty>
                  </div>
                }
              </div>
            } @else {
              <div class="col-span-1">
                <div class="col-span-1 pt-2 pb-4 bg-red-400 h-[17rem]">
                  <div class="mb-4 flex flex-col items-center h-full text-white">
                    <div class="text-xl flex-none font-bold">Pending requests</div>
                    <div class="text-[1rem] font-semibold text-center pt-1 leading-4">Needs action from service owners</div>
                    <div class="text-8xl font-bold mt-auto cursor-pointer" (click)="onStatsClickEvent('Pending', tableModal)" (keypress)="onStatsClickEvent('Pending', tableModal)">{{requestStats.pending}}</div>
                  </div>
                </div>
              </div>
              <div class="col-span-3 py-2">
                @if(requestStats.pending > 0) {
                  <div echarts [options]="requestAgingForServiceOwnerChartOption" class="h-full" (chartClick)="onChartClickEvent($event, tableModal)"></div>
                } @else {
                  <div class="dnf-wrapper h-full flex flex-col w-full justify-center align-middle">
                    <nz-empty nzNotFoundContent="There are no pending requests for the applied filter"></nz-empty>
                  </div>
                }
              </div>
            }
              <div class="col-span-2 rounded border-r-2 py-2 border-gray-500">
                @if(isSLADataUnavailable()) {
                  <div class="dnf-wrapper h-full flex flex-col w-full justify-center align-middle">
                    <nz-empty nzNotFoundContent="SLA data is not available for the selected filter"></nz-empty>
                  </div>
                } @else {
                <div echarts [options]="slaStatusChartOption" class="h-full" (chartClick)="onChartClickEvent($event, tableModal)"></div>
                }
              </div>
            </div>
          </div>
          <div class="col-span-2 p-3">
            <!-- Request type distribution chart for Pending requests -->
            <div class="card rounded border-2 border-gray-500 p-3">
              @if(requestStats.pending > 0) {
              <div class="card-body">
                <div echarts [options]="requestTypeChartOption" class="h-full" (chartClick)="onChartClickEvent($event, tableModal)"></div>
              </div>
            } @else {
              <div class="dnf-wrapper">
                <nz-empty nzNotFoundContent="There are no pending requests for the applied filter"></nz-empty>
              </div>
            }
            </div>
          </div>
          <div class="col-span-4 p-3">
            <!-- Barchart of pending request count by CurrentStage -->
            <div class="card rounded border-2 border-gray-500 p-3 h-full">
            @if(requestStats.pending > 0) {
              <div class="card-body">
                <div echarts [options]="pendingRequestsByCurrentStageChartOption" (chartClick)="onChartClickEvent($event, tableModal)" class="h-full"></div>
              </div>
            } @else {
              <div class="dnf-wrapper">
                <nz-empty nzNotFoundContent="There are no pending requests for the applied filter"></nz-empty>
              </div>
            }
          </div>
          </div>
          <div class="col-span-6 p-3">
            <!-- Heatmap of service owners against current stage for pending requests -->
            <div class="card rounded border-2 border-gray-500 p-3">

              @if(requestStats.pending > 0) {
                <div class="card-body">
                @if(role === 'coordinator' && selectedService === 'all') {
                <div echarts [options]="serviceOwnerByCurrentStageChartOption" class="h-full"  (chartClick)="onChartClickEvent($event, tableModal)"></div>
                } @else {
                <div echarts [options]="serviceOwnerSubtasksCreatedTimeLineChartOption" class="h-full"  (chartClick)="onChartClickEvent($event, tableModal)"></div>
                }
              </div>
            } @else {
              <div class="dnf-wrapper">
                <nz-empty nzNotFoundContent="There are no pending requests for the applied filter"></nz-empty>
              </div>
            }
            </div>
          </div>
        </div>
        } @else {
        <!-- Display No data in a tailwind formatted center box -->
        <div class="flex flex-col h-[80vh] w-full items-center justify-center">
          <nz-empty nzNotFoundContent="Data not found. Please retry with another filter"></nz-empty>
        </div>
        }
      </div>
    }
    <!--#region: Overall metrics for coordinator-->
    <!--#endregion-->
  <!-- }
  @case (1) {
    <span class="text-3xl font-bold">Completed metrics</span>
  }
} -->

<ng-template #tableModal let-ref="modelRef">
  <tracing [dataForModal]="modalData" [displayCols]="modalCols" [pageSizeLimit]="modalPageSize"></tracing>
</ng-template>
